<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Modulo ZADANKAI HOMBU 9</title>
</head>
<body>
  <h1>Immissione Dati ZADANKAI</h1>
  <form id="zadankai-form">
    <label>Anno: <input name="anno" required></label><br>
    <label>Mese: <input name="mese" required></label><br>
    <label>Nome Gruppo: <input name="gruppo" required></label><br>
    <label>Categoria:
      <select name="categoria">
        <option>Membri</option>
        <option>Simpatizzanti</option>
        <option>Ospiti</option>
      </select>
    </label><br>
    <label>Uomini: <input type="number" name="U" min="0"></label><br>
    <label>Donne: <input type="number" name="D" min="0"></label><br>
    <label>Giovani Uomini: <input type="number" name="GU" min="0"></label><br>
    <label>Giovani Donne: <input type="number" name="GD" min="0"></label><br>
    <label>FUT: <input type="number" name="FUT" min="0"></label><br>
    <label>STU: <input type="number" name="STU" min="0"></label><br>
    <label>Note: <textarea name="note"></textarea></label><br>
    <button type="submit">Salva</button>
  </form>

  <hr>
    <a href="visualizza.html" style="display:inline-block; padding:10px 20px; background:#007bff; color:white; text-decoration:none; border-radius:5px;">
    ðŸ“Š Visualizza dati salvati
</a>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
    import { firebaseConfig } from "./firebase-config.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    document.getElementById("zadankai-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target));
      const key = `${data.anno}-${data.mese}-${data.gruppo}`;
      const categoria = data.categoria;

      const payload = {
        U: parseInt(data.U || 0),
        D: parseInt(data.D || 0),
        GU: parseInt(data.GU || 0),
        GD: parseInt(data.GD || 0),
        FUT: parseInt(data.FUT || 0),
        STU: parseInt(data.STU || 0),
        note: data.note || ""
      };

      set(ref(db, `zadankai/${key}/${categoria}`), payload).then(() => {
        alert("Dati salvati con successo!");
        e.target.reset();
      }).catch((error) => {
        alert("Errore nel salvataggio: " + error.message);
      });
    });
  </script>
</body>
</html>
